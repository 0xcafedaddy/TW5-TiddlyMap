/*\

title: $:/plugins/felixhayashi/taskgraph/utils.js
type: application/javascript
module-type: library

ATTENTION: THIS CLASS MUST NOT REQUIRE ANY OTHER TASKGRAPH FILE
IN ORDER TO AVOID ACYCLIC DEPENDENCIES!

@preserve

\*/
var vis=require("$:/plugins/felixhayashi/vis/vis.js");var utils={};utils.deleteTiddlers=function(t){var e=Object.keys(t);for(var i=0;i<e.length;i++){if(utils.tiddlerExists(t[e[i]])){var r=utils.getTiddlerReference(t[e[i]]);$tw.wiki.deleteTiddler(r)}}};utils.getTiddlerIds=function(t,e){var i=[];var r=Object.keys(t);for(var s=0;s<r.length;s++){if(utils.tiddlerExists(t[r[s]])){var n=utils.getTiddler(t[r[s]]).fields[e];i.push(n)}}return i};utils.getExistenceMap=function(t){if(t instanceof vis.DataSet){t=t.getIds()}else if(!Array.isArray(t)){t=Object.keys(t)}var e=utils.getEmptyMap();for(var i=0;i<t.length;i++){e[t[i]]=true}return e};utils.getLabel=function(t,e){var i=utils.getTiddler(t);return i&&i.fields[e]?i.fields[e]:i.fields.title};utils.convert=function(t,e){if(typeof t!=="object")return;switch(e){case"array":return utils.getValues(t);case"hashmap":case"object":if(t instanceof vis.DataSet){return vis.get({returnType:"Object"})}else{return t}case"dataset":default:if(t instanceof vis.DataSet){return t}if(!Array.isArray(t)){t=utils.getValues(t)}return new vis.DataSet(t)}};utils.inject=function(t,e){if(e instanceof vis.DataSet){e.update(utils.convert(t,"array"))}else if(Array.isArray(e)){t=utils.convert(t,"object");for(var i in t){if(e.indexOf(t[i])==-1){e.push(t[i])}}}else{$tw.utils.extend(e,utils.convert(t,"object"))}return e};utils.getValues=function(t){if(Array.isArray(t)){return t}if(t instanceof vis.DataSet){return t.get({returnType:"Array"})}var e=[];var i=Object.keys(t);for(var r=0;r<i.length;r++){e.push(t[i[r]])}return e};utils.hasOwnProp=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};utils.getEmptyMap=function(){var t=Object.create(null);Object.defineProperty(t,"hasOwnProperty",{enumerable:false,configurable:false,writable:false,value:Object.prototype.hasOwnProperty.bind(t)});return t};utils.getMatches=function(t,e,i){var r=undefined;if(typeof e==="object"){var s=Object.keys(e);r=function(t){for(var i=0;i<s.length;i++){var r=utils.getTiddler(e[s[i]]);if(r){t(r,r.fields.title)}}}}if(typeof t==="string"){t=$tw.wiki.compileFilter(t)}var n=t.call($tw.wiki,r);return n};utils.isMatch=function(t,e){var i=utils.getTiddlerReference(t);return utils.getMatches(e,[i]).length>0};utils.getTiddlerReference=function(t){if(t instanceof $tw.Tiddler){return t.fields.title}else if(typeof t==="string"){return t}};utils.getTiddler=function(t){return t instanceof $tw.Tiddler?t:$tw.wiki.getTiddler(t)};utils.getBasename=function(t){return t.substring(t.lastIndexOf("/")+1)};utils.notify=function(t){var e="$:/temp/taskgraph/notify";$tw.wiki.addTiddler(new $tw.Tiddler({title:e,text:t}));$tw.notifier.display(e)};utils.tiddlerExists=function(t){var e=utils.getTiddlerReference(t);return e&&($tw.wiki.tiddlerExists(e)||$tw.wiki.isShadowTiddler(e))};utils.getPropertiesByPrefix=function(t,e,i){var r=utils.getEmptyMap();for(var s in t){if(utils.startsWith(s,e)){r[i?s.substr(e.length):s]=t[s]}}return r};utils.getDomNodePos=function(t){var e={x:0,y:0};while(true){e.x+=t.offsetLeft;e.y+=t.offsetTop;if(t.offsetParent===null)break;t=t.offsetParent}return e};utils.startsWith=function(t,e){return typeof t==="string"&&t.indexOf(e)===0};utils.hasElements=function(t){return Object.keys(t).length>0};utils.isDraft=function(t){return utils.getTiddler(t)&&utils.getTiddler(t).isDraft()};utils.getText=function(t,e){if(!e){e=""}var i=utils.getTiddler(t);return i?i.fields.text:e};utils.keysOfItemsWithProperty=function(t,e,i,r){t=utils.getIterableCollection(t);var s=Object.keys(t);var n=[];var r=typeof r==="number"?r:s.length;for(var l=0;l<s.length;l++){var u=s[l];if(typeof t[u]==="object"&&t[u][e]){if(!i||t[u][e]===i){n.push(u);if(n.length===r){break}}}}return n};utils.keyOfItemWithProperty=function(t,e,i){var r=utils.keysOfItemsWithProperty(t,e,i,1);return r.length?r[0]:undefined};utils.getIterableCollection=function(t){return t instanceof vis.DataSet?t.get():t};utils.getLookupTable=function(t,e){t=utils.getIterableCollection(t);var i=utils.getEmptyMap();var r=Object.keys(t);for(var s=0;s<r.length;s++){var n=r[s];var l=e?t[n][e]:t[n];if(typeof l==="string"&&l!=""||typeof l==="number"){if(!i[l]){i[l]=t[n];continue}}throw'Taskgraph: Cannot use "'+l+'" as lookup table index'}return i};utils.getArrayValuesAsHashmapKeys=function(t){return utils.getLookupTable(t)};utils.getTiddlersWithProperty=function(t,e,i){if(typeof i!=="object")i=utils.getEmptyMap();if(!i.tiddlers){i.tiddlers=$tw.wiki.allTitles()}var r=[];var s=i.isReturnRef;var n=Object.keys(i.tiddlers);for(var l=0;l<n.length;l++){var u=utils.getTiddler(i.tiddlers[n[l]]);if(u.fields[t]===e){r.push(s?u.fields.title:u);if(i.isIncludeDrafts){var a=$tw.wiki.findDraft(u.fields.title);if(a){r.push(s?a:$tw.wiki.getTiddler(a))}}}}return r};utils.genUUID=function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(){var e=t,i=new Array(36);var r=0,s;for(var n=0;n<36;n++){if(n==8||n==13||n==18||n==23){i[n]="-"}else if(n==14){i[n]="4"}else{if(r<=2)r=33554432+Math.random()*16777216|0;s=r&15;r=r>>4;i[n]=e[n==19?s&3|8:s]}}return i.join("")}}();exports.utils=utils;