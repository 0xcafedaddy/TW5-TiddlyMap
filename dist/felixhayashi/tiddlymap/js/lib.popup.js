/*\

title: $:/plugins/felixhayashi/tiddlymap/js/Popup
type: application/javascript
module-type: library

@preserve

\*/
"use strict";module.exports=Popup;var utils=require("$:/plugins/felixhayashi/tiddlymap/js/utils");function Popup(t,e){e=e||{};this._parentDomNode=t;this._domNode=document.createElement("div");this._domNode.style.display="none";this._domNode.className="tmap-popup";this._parentDomNode.appendChild(this._domNode);$tw.utils.addClass(this._domNode,e.className);this._isEnabled=true;this._isPreventShowOrHide=false;this._timeoutShow=null;this._timeoutHide=null;this._signature=null;this._isDisplayNoneAfterAnimation=true;this._hideDelayLeavingPopup=200;this._hideDelay=utils.isInteger(parseInt(e.hideDelay))?parseInt(e.hideDelay):200;this._showDelay=utils.isInteger(parseInt(e.showDelay))?parseInt(e.showDelay):200;utils.bind(this,["_show","_hide","_handleEnter","_handleLeave","_handleAnimationEnd"]);this._listeners={mouseenter:this._handleEnter,mouseleave:this._handleLeave};var i=this._handleAnimationEnd;this._listeners[$tw.utils.convertEventName("animationEnd")]=i;this._listeners[$tw.utils.convertEventName("transitionEnd")]=i;utils.setDomListeners("add",this._domNode,this._listeners,false)}Popup.prototype._handleEnter=function(t){this._isPreventShowOrHide=true};Popup.prototype._handleLeave=function(t){this._isPreventShowOrHide=false;this.hide(this._hideDelayLeavingPopup)};Popup.prototype._handleAnimationEnd=function(){if(this._isDisplayNoneAfterAnimation){this._domNode.style.display="none"}};Popup.prototype._hide=function(t){if(!t&&this._isPreventShowOrHide)return;this._signature=null;this._isDisplayNoneAfterAnimation=true;$tw.utils.removeClass(this._domNode,"tmap-popup-active")};Popup.prototype._show=function(t,e){if(this._isPreventShowOrHide||$tm.mouse.ctrlKey||!this._isEnabled){return}this._domNode.style.display="none";$tw.utils.removeClass(this._domNode,"tmap-popup-active");this._domNode.removeAttribute("style");utils.removeDOMChildNodes(this._domNode);var i=this._domNode.appendChild(document.createElement("div"));if(typeof e==="function"){e(t,i)}else{i.innerHTML=e}if(!i.childNodes.length)return;var s=this._parentDomNode.getBoundingClientRect();var o=$tm.mouse.clientX;var n=$tm.mouse.clientY;var h=s.left<o&&o<s.right&&s.top<n&&n<s.bottom;if(!h)return;this._signature=t;this._domNode.style.display="block";var d=this._domNode.getBoundingClientRect();var a=s.right-(o+d.width);var l=o-d.width-s.left;var r=a>l;var p=s.bottom-(n+d.height);var u=n-d.height-s.top;var m=p>u;var _=r?-15:d.width+15;var v=m?-15:d.height+15;this._domNode.style.left=o-s.left-_+"px";this._domNode.style.top=n-s.top-v+"px";this._isDisplayNoneAfterAnimation=false;$tw.utils.addClass(this._domNode,"tmap-popup-active")};Popup.prototype.show=function(t,e,i){this._clearTimeouts();i=utils.isInteger(i)?i:this._showDelay;this._timeoutShow=window.setTimeout(this._show,i,t,e)};Popup.prototype.hide=function(t,e){this._clearTimeouts();t=utils.isInteger(t)?t:this._hideDelay;if(e||t===0){this._hide(e)}else{this._timeoutHide=window.setTimeout(this._hide,t,e)}};Popup.prototype.setEnabled=function(t){this._isEnabled=t};Popup.prototype._clearTimeouts=function(){window.clearTimeout(this._timeoutShow);window.clearTimeout(this._timeoutHide);this._timeoutShow=undefined;this._timeoutHide=undefined};