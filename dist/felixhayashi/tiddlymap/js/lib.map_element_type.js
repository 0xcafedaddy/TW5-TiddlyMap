/*\

title: $:/plugins/felixhayashi/tiddlymap/js/MapElementType
type: application/javascript
module-type: library

@preserve

\*/
"use strict";module.exports=MapElementType;var utils=require("$:/plugins/felixhayashi/tiddlymap/js/utils");function MapElementType(t,i,e,s){this.id=t;this.root=i;this._fieldMeta=e;this.fullPath=this.root+"/"+this.id;this.isShipped=$tw.wiki.getSubTiddler($tm.path.pluginRoot,this.fullPath);this.load(s||this.fullPath)}MapElementType._fieldMeta={description:{},style:{parse:utils.parseJSON,stringify:JSON.stringify},modified:{},created:{}};MapElementType.prototype.load=function(t){if(!t)return;if(typeof t==="string"){var i=utils.startsWith(t,this.root);var e=i?t:this.root+"/"+t;this.loadFromTiddler(e)}else if(t instanceof $tw.Tiddler){this.loadFromTiddler(t)}else if(typeof t==="object"){for(var s in this._fieldMeta){this[s]=t[s]}}};MapElementType.prototype.loadFromTiddler=function(t){var i=utils.getTiddler(t);if(!i)return;var e=$tw.wiki.getSubTiddler($tm.path.pluginRoot,this.fullPath)||{};var s=$tw.utils.extend({},e.fields,i.fields);for(var l in this._fieldMeta){var r=this._fieldMeta[l].parse;var a=s[l];this[l]=r?r.call(this,a):a}};MapElementType.prototype.exists=function(){return utils.tiddlerExists(this.fullPath)};MapElementType.prototype.setStyle=function(t,i){if(typeof t==="string"){t=utils.parseJSON(t)}if(typeof t==="object"){if(i){utils.merge(this.style,t)}else{this.style=t}}};MapElementType.prototype.save=function(t,i){if(!t){t=this.fullPath}else if(typeof t!=="string"){return}var e={title:t,text:""};if(!utils.startsWith(t,this.root)){e.id=this.id}if(i!==true){this.modified=new Date}if(!this.exists()){this.created=this.modified}for(var s in this._fieldMeta){var l=this._fieldMeta[s].stringify;e[s]=l?l.call(this,this[s]):this[s]}$tw.wiki.addTiddler(new $tw.Tiddler(e))};