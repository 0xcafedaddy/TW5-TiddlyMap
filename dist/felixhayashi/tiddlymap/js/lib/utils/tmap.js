"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSnapshotTitle=exports.getArrayValuesAsHashmapKeys=exports.getLookupTable=exports.keyOfItemWithProperty=exports.keysOfItemsWithProperty=exports.getDublicates=exports.getId=exports.refreshDataSet=exports.drawRaster=exports.getPrettyFilter=exports.groupByProperty=exports.isEdgeTypeMatch=exports.getEdgeTypeMatches=exports.getDataUri=exports.convert=exports.getValues=exports.getIterableCollection=exports.getLabel=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};// @preserve
/*\

title: $:/plugins/felixhayashi/tiddlymap/js/lib/utils/tmap
type: application/javascript
module-type: library

@preserve

\*/
var _vis=require("$:/plugins/felixhayashi/vis/vis.js");var _vis2=_interopRequireDefault(_vis);var _exception=require("$:/plugins/felixhayashi/tiddlymap/js/exception");var _basic=require("$:/plugins/felixhayashi/tiddlymap/js/lib/utils/basic");var basicUtils=_interopRequireWildcard(_basic);var _wiki=require("$:/plugins/felixhayashi/tiddlymap/js/lib/utils/wiki");var wikiUtils=_interopRequireWildcard(_wiki);function _interopRequireWildcard(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var getLabel=exports.getLabel=function e(t,r){var i=wikiUtils.getTiddler(t);return i&&i.fields[r]?i.fields[r]:i.fields.title};var getIterableCollection=exports.getIterableCollection=function e(t){return t instanceof _vis2.default.DataSet?t.get():t};var getValues=exports.getValues=function e(t){if(Array.isArray(t)){return t}else if(t instanceof _vis2.default.DataSet){return t.get({returnType:"Array"})}var r=[];var i=Object.keys(t);for(var a=i.length;a--;){r.push(t[i[a]])}return r};var convert=exports.convert=function e(t,r){if((typeof t==="undefined"?"undefined":_typeof(t))!=="object"){throw new _exception.InvalidArgumentException(t,r)}if(r==="object"){r="hashmap"}var i={array:function e(t){return getValues(t)},hashmap:function e(t){return t instanceof _vis2.default.DataSet?t.get({returnType:"Object"}):t},dataset:function e(t){return t instanceof _vis2.default.DataSet?t:!Array.isArray(t)?getValues(t):new _vis2.default.DataSet(t)}};return i[r](t)};var getDataUri=exports.getDataUri=function e(t,r,i){var a=wikiUtils.getTiddler(t);r=r||a.fields.type||"image/svg+xml";var o=a.fields.text;var s=$tw.config.contentTypeInfo[r].encoding;if(r==="image/svg+xml"){o=o.replace(/\r?\n|\r/g," ");if(!basicUtils.hasSubString("xmlns",o)){o=o.replace(/<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')}}if(i&&s!=="base64"){s="base64";o=window.btoa(o)}return"data:"+r+";"+s+","+o};var eTyFiltAutoPrefix="[all[]] ";var getEdgeTypeMatches=exports.getEdgeTypeMatches=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var r=arguments[1];if(!r){r=wikiUtils.getTiddlersByPrefix($tm.path.edgeTypes+"/",{iterator:"eachTiddlerPlusShadows",removePrefix:true})}if(r!=null&&!Array.isArray(r)){r=Object.keys(r)}return wikiUtils.getMatches(eTyFiltAutoPrefix+t,r)};var isEdgeTypeMatch=exports.isEdgeTypeMatch=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return wikiUtils.isMatch(t,eTyFiltAutoPrefix+r)};var groupByProperty=exports.groupByProperty=function e(t,r){t=getIterableCollection(t);var i=basicUtils.makeHashMap();var a=Object.keys(t);for(var o in a){var s=t[a[o]];var n=s[r];if(n==null){throw"Cannot group by property "+r}else{if(!Array.isArray(i[n])){i[n]=[]}i[n].push(s)}}return i};var getPrettyFilter=exports.getPrettyFilter=function e(t){t=t.trim().replace("][","] [");var r=/[+-]?\[.+?[\]\}\>]\]/g;var i=t.match(r);t=t.replace(r," [] ").trim();var a=t.split(/\s+/);var o=0;var s=[];for(var n=0,l=a.length;n<l;n++){s[n]=a[n]==="[]"?i[o++]:a[n]}return s.join("\n")};var drawRaster=exports.drawRaster=function e(t,r,i,a,o){a=parseInt(a)||10;var s=t.canvas;var n=s.width/r;var l=s.width/r;var u=i.x-n/2;var p=i.y-l/2;for(var f=u;f<n;f+=a){t.moveTo(f,p);t.lineTo(f,l)}for(var v=p;v<l;v+=a){t.moveTo(u,v);t.lineTo(n,v)}t.strokeStyle=o||"#D9D9D9";t.stroke()};var refreshDataSet=exports.refreshDataSet=function e(t,r){var i=t.get({returnType:"Object"});var a=[];var o=[];var s=[];var n=[];for(var l in r){if(i[l]){if(basicUtils.isEqual(i[l],r[l])){continue}o.push(l);t.remove(l)}else{a.push(l)}if(!r[l].x){s.push(l)}t.add(r[l])}for(var u in i){if(!r[u]){n.push(u);t.remove(u)}}return{withoutPosition:s,inserted:a,updated:o,removed:n}};var getId=exports.getId=function e(t){return wikiUtils.getTiddler(t).fields["tmap.id"]};var getDublicates=exports.getDublicates=function e(t){var r=getId(t);if(!r){return[]}var i=wikiUtils.getTiddlersWithField("tmap.id",r,{limit:2});delete i[wikiUtils.getTiddlerRef(t)];return Object.keys(i)};var keysOfItemsWithProperty=exports.keysOfItemsWithProperty=function e(t,r,i,a){t=getIterableCollection(t);var o=Object.keys(t);var s=[];a=typeof a==="number"?a:o.length;for(var n=0,l=o.length;n<l;n++){var u=o[n];if(_typeof(t[u])==="object"&&t[u][r]){if(!i||t[u][r]===i){s.push(u);if(s.length===a){break}}}}return s};var keyOfItemWithProperty=exports.keyOfItemWithProperty=function e(t,r,i){return keysOfItemsWithProperty(t,r,i,1)[0]};var getLookupTable=exports.getLookupTable=function e(t,r){t=getIterableCollection(t);var i=basicUtils.makeHashMap();var a=Object.keys(t);for(var o=0,s=a.length;o<s;o++){var n=a[o];var l=r?t[n][r]:t[n];var u=typeof l==="undefined"?"undefined":_typeof(l);if(u==="string"&&l!==""||u==="number"){if(!i[l]){i[l]=r?t[n]:true;continue}}throw new Error('Cannot use "'+l+'" as lookup table index')}return i};var getArrayValuesAsHashmapKeys=exports.getArrayValuesAsHashmapKeys=getLookupTable;var getSnapshotTitle=exports.getSnapshotTitle=function e(t,r){return"Snapshot â€“ "+t+" ("+(new Date).toDateString()+"). "+(r||"png")};
//# sourceMappingURL=./maps/felixhayashi/tiddlymap/js/lib/utils/tmap.js.map
