/*\
title: $:/plugins/felixhayashi/tiddlymap/js/macro/tmap
type: application/javascript
module-type: macro

@preserve

\*/
"use strict";exports.name="tmap";exports.params=getParamSlots(5);exports.run=run;var EdgeType=require("$:/plugins/felixhayashi/tiddlymap/js/EdgeType");var utils=require("$:/plugins/felixhayashi/tiddlymap/js/utils");var ViewAbstraction=require("$:/plugins/felixhayashi/tiddlymap/js/ViewAbstraction");function run(){this.substVarRefs=this.substituteVariableReferences;var r=command[arguments[0]];var t=null;if(typeof r==="function"){var e=Array.prototype.slice.call(arguments,1);var t=r.apply(this,e)}return typeof t==="string"?t:""}function getParamSlots(r){var t=[];for(var e=0;e<r;e++){t.push({name:"arg"+e})}return t}var command=utils.makeHashMap();command.basename=function(r){var t=r||this.getVariable("currentTiddler");return utils.getBasename(t)};command.datauri=function(r,t){return utils.getDataUri(r,t,true)};command.testJSON=function(r){var t=$tw.wiki.getTiddler(this.getVariable("currentTiddler"));try{JSON.parse(t.fields[r]);return"valid"}catch(e){return"malformed"}};command.splitAndSelect=function(r,t){var e=this.getVariable("currentTiddler");var a=e.split(r)[t];return a!=null?a:e};command.concat=function(){var r="";for(var t=1,e=arguments.length;t<e;t++){r+=arguments[t]}return r};command.uuid=function(){return utils.genUUID()};command.regRepl=function(){var r=this.substVarRefs(arguments[0]);var t=arguments[1];var e=this.substVarRefs(arguments[2]);var a=this.substVarRefs(arguments[4]);return r.replace(new RegExp(t,a),e)};command.halfOfString=function(){var r=this.substVarRefs(arguments[0]);if(!r)return"";return r.substr(0,Math.ceil(r.length/2))};command.isETyVisible=function(r,t,e){e=command.getETyId.call(this,r,e);return""+utils.isEdgeTypeMatch(e,t)};command.getETyId=function(r,t){t=t||this.getVariable("currentTiddler");return new EdgeType(t,null,{namespace:r}).id};command.scale=function(){var r="";for(var t=1,e=parseInt(arguments[0]);t<e;t++){r+="[["+t+"]]"}return r};command.mergeFields=function(){var r=utils.getTiddler(arguments[0]);var t=arguments[1];var e=arguments[2]||" ";if(!r)return;var a=utils.getPropertiesByPrefix(r.fields,t);var n="";for(var i in a){if(typeof a[i]==="string"){n+=a[i]+e}}return n};command.option=function(r,t){var e=$tm;var a=r.split(".");for(var n=0;n<a.length;n++){if(typeof e=="object"&&e[a[n]]){e=e[a[n]]}}if(t&&typeof e==="string"&&utils.hasSubString(t)&&e.lastIndexOf(t)+t.length===e.length){e=e+t}return e};