/*\

title: $:/plugins/felixhayashi/tiddlymap/edgetype.js
type: application/javascript
module-type: library

@module TiddlyMap
@preserve

\*/
(function(){var t=require("$:/plugins/felixhayashi/tiddlymap/utils.js").utils;var e=function(i){if(i instanceof e){return i}if(!i){i="tmap:unknown"}else if(typeof i!=="string"){throw"Cannot create edge-type"}this.createShortcuts();this.data=t.getDataMap();this.whitelist=["description","style","label","modified","created","show-label"];this.id=t.getWithoutPrefix(i,this.opt.path.edgeTypes+"/");this.loadDataFromType(this.id)};e.prototype.createShortcuts=function(){this.wiki=$tw.wiki;this.opt=$tw.tmap.opt;this.logger=$tw.tmap.logger};e.prototype.getPath=function(){return this.opt.path.edgeTypes+"/"+this.id};e.prototype.exists=function(){return t.tiddlerExists(this.getPath())};e.prototype.getLabel=function(){return this.data.label||this.id.substring(this.id.indexOf(":")+1)};e.prototype.getId=function(){return this.id};e.prototype.getData=function(t){if(t==="label"){return this.getLabel()}return t?this.data[t]:this.data};e.prototype.setData=function(){var e=arguments;if(e.length===2){if(typeof e[0]==="string"){if(e[0]==="style"){this.setStyle(e[1])}else{if(e[1]&&t.inArray(e[0],this.whitelist)){this.data[e[0]]=e[1]}else{delete this.data[e[0]]}}}}else if(e.length===1&&typeof e[0]==="object"){for(var i in e[0]){this.setData(i,e[0][i])}}};e.prototype.setStyle=function(e,i){if(typeof e==="string"){e=t.parseJSON(e)}if(typeof e==="object"){if(i){t.merge(this.data.style,e)}else{this.data.style=e}}};e.prototype.persist=function(e,i){if(!e){e=this.getPath()}if(typeof e==="string"){var s={title:e};if(!t.startsWith(e,this.opt.path.edgeTypes)){s.id=this.id}else{$tw.utils.extend(s,this.wiki.getModificationFields());if(!this.exists()){$tw.utils.extend(s,this.wiki.getCreationFields())}}if(this.data.style){var a=i?$tw.config.preferences.jsonSpaces:null;this.data.style=JSON.stringify(this.data.style,null,a)}$tw.wiki.addTiddler(new $tw.Tiddler(this.data,s))}};e.prototype.isAutoGenerated=function(){return this.id==="tmap:link"};e.prototype.loadDataFromType=function(i){if(i instanceof e){this.setData(i.getData())}else{if(i instanceof $tw.Tiddler){i=i.fields.title}if(typeof i==="string"){if(!t.startsWith(i,this.opt.path.edgeTypes)){i=this.opt.path.edgeTypes+"/"+i}this.loadDataFromTiddler(this.wiki.getTiddler(i),false)}}};e.prototype.loadDataFromTiddler=function(e){var i=t.getTiddler(e);if(i){var s=$tw.wiki.getSubTiddler(this.opt.path.pluginRoot,this.getPath());if(!s){s={}}var a=$tw.utils.extend({},s.fields,i.fields);this.setData(a)}};exports.EdgeType=e})();