/*\

title: $:/plugins/felixhayashi/tiddlymap/edgetype.js
type: application/javascript
module-type: library

@module TiddlyMap
@preserve

\*/
(function(){var t=function(i){if(i instanceof t){return i}if(!i){i="tmap:unknown"}else if(typeof i!=="string"){throw"Cannot create edge-type"}this.createShortcuts();this.data=this.utils.getDataMap();this.whitelist=["description","style","label","modified","created","show-label"];this.id=this.utils.getWithoutPrefix(i,this.opt.path.edgeTypes+"/");this.loadDataFromType(this.id)};t.prototype.createShortcuts=function(){this.wiki=$tw.wiki;this.opt=$tw.tmap.opt;this.logger=$tw.tmap.logger;this.utils=$tw.tmap.utils};t.prototype.getPath=function(){return this.opt.path.edgeTypes+"/"+this.id};t.prototype.exists=function(){return this.utils.tiddlerExists(this.getPath())};t.prototype.getLabel=function(){return this.data.label||this.id.substring(this.id.indexOf(":")+1)};t.prototype.getId=function(){return this.id};t.prototype.getData=function(t){if(t==="label"){return this.getLabel()}return t?this.data[t]:this.data};t.prototype.setData=function(){var t=arguments;if(t.length===2){if(typeof t[0]==="string"){if(t[0]==="style"){this.setStyle(t[1])}else{if(t[1]&&this.utils.inArray(t[0],this.whitelist)){this.data[t[0]]=t[1]}else{delete this.data[t[0]]}}}}else if(t.length===1&&typeof t[0]==="object"){for(var i in t[0]){this.setData(i,t[0][i])}}};t.prototype.setStyle=function(t,i){if(typeof t==="string"){t=this.utils.parseJSON(t)}if(typeof t==="object"){if(i){this.utils.merge(this.data.style,t)}else{this.data.style=t}}};t.prototype.persist=function(t,i){if(!t){t=this.getPath()}if(typeof t==="string"){var e={title:t};if(!this.utils.startsWith(t,this.opt.path.edgeTypes)){e.id=this.id}else{$tw.utils.extend(e,this.wiki.getModificationFields());if(!this.exists()){$tw.utils.extend(e,this.wiki.getCreationFields())}}var s=i?$tw.config.preferences.jsonSpaces:null;this.data.style=JSON.stringify(this.data.style,null,s);$tw.wiki.addTiddler(new $tw.Tiddler(this.data,e))}};t.prototype.isAutoGenerated=function(){return this.id==="tmap:link"};t.prototype.loadDataFromType=function(i){if(i instanceof t){this.setData(i.getData())}else{if(i instanceof $tw.Tiddler){i=i.fields.title}if(typeof i==="string"){if(!this.utils.startsWith(i,this.opt.path.edgeTypes)){i=this.opt.path.edgeTypes+"/"+i}this.loadDataFromTiddler(this.wiki.getTiddler(i),false)}}};t.prototype.loadDataFromTiddler=function(t){var i=this.utils.getTiddler(t);if(i){var e=$tw.wiki.getSubTiddler(this.opt.path.pluginRoot,this.getPath())||{};var s=$tw.utils.extend({},e.fields,i.fields);this.setData(s)}};exports.EdgeType=t})();