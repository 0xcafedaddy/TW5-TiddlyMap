/*\

title: $:/plugins/felixhayashi/tiddlymap/widget/connections.js
type: application/javascript
module-type: widget

@preserve

\*/
(function(){"use strict";var e=require("$:/core/modules/widgets/widget.js").widget;var t=require("$:/plugins/felixhayashi/tiddlymap/utils.js").utils;var r=require("$:/plugins/felixhayashi/tiddlymap/edgetype.js").EdgeType;var i=function(t,r){e.call(this,t,r)};i.prototype=Object.create(e.prototype);i.prototype.render=function(e,t){this.parentDomNode=e;this.computeAttributes();this.execute();this.renderChildren(e,t)};i.prototype.execute=function(){var e="[field:title["+this.getVariable("currentTiddler")+"]!has[draft.of]]";var t=this.getAttribute("filter",e);var r=$tw.tmap.adapter.getNeighbours([this.getVariable("currentTiddler")],{typeFilter:{"tmap:link":true},typeFilterStyle:"blacklist"});this.neighbours=r.nodes;this.edges=r.edges;var i=[];for(var s in this.edges){var a=this.makeItemTemplate(this.edges[s]);if(a){i.push(a)}}this.makeChildWidgets(i)};i.prototype.makeItemTemplate=function(e){var t="";var r=this.neighbours[e.to]?"To":"From";var i=this.neighbours[e[r.toLowerCase()]];if(!i)return;return{type:"tmap-edgelistitem",edge:e,link:i,linkRole:r,children:this.parseTreeNode.children}};i.prototype.refresh=function(e){for(var r in e){if(!t.isSystemOrDraft(r)){this.refreshSelf();return true}}return this.refreshChildren(e)};exports["tmap-connections"]=i;var s=function(t,r){e.call(this,t,r)};s.prototype=Object.create(e.prototype);s.prototype.execute=function(){var e=this.parseTreeNode;var t=$tw.tmap.indeces.tById[e.link.id];var i=new r(e.edge.type);this.setVariable("currentTiddler",t);this.setVariable("edge.from",e.edge.from);this.setVariable("edge.id",e.edge.id);this.setVariable("edge.label",i.getLabel());this.setVariable("edge.type",i.getId());this.setVariable("neighbour",t);this.setVariable("role",e.linkRole);this.makeChildWidgets()};s.prototype.refresh=function(e){return this.refreshChildren(e)};exports["tmap-edgelistitem"]=s})();