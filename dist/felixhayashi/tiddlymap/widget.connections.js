/*\

title: $:/plugins/felixhayashi/tiddlymap/js/widget/connections
type: application/javascript
module-type: widget

@module TiddlyMap
@preserve

\*/
(function(){"use strict";var e=require("$:/core/modules/widgets/widget.js").widget;var t=require("$:/plugins/felixhayashi/tiddlymap/js/EdgeType").EdgeType;var r=function(t,r){e.call(this,t,r);this.utils=$tw.tmap.utils};r.prototype=Object.create(e.prototype);r.prototype.render=function(e,t){this.parentDomNode=e;this.computeAttributes();this.execute();this.renderChildren(e,t)};r.prototype.execute=function(){var e=[this.getVariable("currentTiddler")];var t=this.getAttribute("filter","");var r={typeWL:$tw.tmap.adapter.getEdgeTypeWhiteList(t)};var i=$tw.tmap.adapter.getNeighbours(e,r);var s=i.nodes;var a=i.edges;var o=[];for(var n in a){var p=a[n];var h=s[p.to]||s[p.from];if(!h)continue;o.push({type:"tmap-edgelistitem",edge:p,typeWL:r.typeWL,neighbour:h,children:this.parseTreeNode.children})}if(!o.length){this.wasEmpty=true;o=this.getEmptyMessage()}else if(this.wasEmpty){this.removeChildDomNodes()}this.makeChildWidgets(o)};r.prototype.getEmptyMessage=function(){var e=this.wiki.parseText("text/vnd.tiddlywiki",this.getAttribute("emptyMessage",""),{parseAsInline:true});return e?e.tree:[]};r.prototype.refresh=function(e){var t=this.computeAttributes();if(t.filter||t.emptyMessage){this.refreshSelf();return true}for(var r in e){if(!this.utils.isSystemOrDraft(r)){this.refreshSelf();return true}}return this.refreshChildren(e)};exports["tmap-connections"]=r;var i=function(t,r){e.call(this,t,r);this.utils=$tw.tmap.utils};i.prototype=Object.create(e.prototype);i.prototype.execute=function(){var e=this.parseTreeNode;var t=$tw.tmap.indeces.tById[e.neighbour.id];var r=this.utils.flatten(e.edge);for(var i in r){if(typeof r[i]==="string"){this.setVariable("edge."+i,r[i])}}this.setVariable("currentTiddler",t);this.setVariable("neighbour",t);var s=$tw.tmap.indeces.allETy[r.type];var a=r.to===e.neighbour.id?"to":"from";var o=a;if(s.biArrow){o="bi"}else{if(a==="to"&&s.invertedArrow){o="from"}else if(a==="from"&&s.invertedArrow){o="to"}}this.setVariable("direction",o);this.setVariable("directionSymbol",o==="bi"?"⬄":o==="from"?"⇦":"⇨");this.makeChildWidgets()};i.prototype.refresh=function(e){return this.refreshChildren(e)};exports["tmap-edgelistitem"]=i})();