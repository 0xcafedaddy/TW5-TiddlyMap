/*\

title: $:/plugins/felixhayashi/tiddlymap/utils.js
type: application/javascript
module-type: library

ATTENTION: THIS CLASS MUST NOT REQUIRE ANY OTHER TIDDLYMAP FILE
IN ORDER TO AVOID ACYCLIC DEPENDENCIES!

@preserve

\*/
var vis=require("$:/plugins/felixhayashi/vis/vis.js");var utils={};utils.deleteTiddlers=function(e){var t=Object.keys(e);for(var r=0;r<t.length;r++){if(utils.tiddlerExists(e[t[r]])){var i=utils.getTiddlerReference(e[t[r]]);$tw.wiki.deleteTiddler(i)}}};utils.getTiddlerIds=function(e,t){var r=[];var i=Object.keys(e);for(var n=0;n<i.length;n++){if(utils.tiddlerExists(e[i[n]])){var l=utils.getTiddler(e[i[n]]).fields[t];r.push(l)}}return r};utils.getTiddlerById=function(e,t){if(!t)t="id";var r=$tw.wiki.allTitles();for(var i=0;i<r.length;i++){var n=utils.getTiddler(r[i]);if(n.fields[t]===e){return n}}};utils.getLabel=function(e,t){var r=utils.getTiddler(e);return r&&r.fields[t]?r.fields[t]:r.fields.title};utils.convert=function(e,t){if(typeof e!=="object")return;switch(t){case"array":return utils.getValues(e);case"hashmap":case"object":if(e instanceof vis.DataSet){return vis.get({returnType:"Object"})}else{return e}case"dataset":default:if(e instanceof vis.DataSet){return e}if(!Array.isArray(e)){e=utils.getValues(e)}return new vis.DataSet(e)}};utils.inject=function(e,t){if(t instanceof vis.DataSet){t.update(utils.convert(e,"array"))}else if(Array.isArray(t)){e=utils.convert(e,"object");for(var r in e){if(t.indexOf(e[r])==-1){t.push(e[r])}}}else{$tw.utils.extend(t,utils.convert(e,"object"))}return t};utils.getValues=function(e){if(Array.isArray(e)){return e}if(e instanceof vis.DataSet){return e.get({returnType:"Array"})}var t=[];var r=Object.keys(e);for(var i=0;i<r.length;i++){t.push(e[r[i]])}return t};utils.hasOwnProp=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};utils.getEmptyMap=function(){var e=Object.create(null);Object.defineProperty(e,"hasOwnProperty",{enumerable:false,configurable:false,writable:false,value:Object.prototype.hasOwnProperty.bind(e)});return e};utils.getMatches=function(e,t,r){var i=undefined;if(typeof t==="object"){var n=Object.keys(t);i=function(e){for(var r=0;r<n.length;r++){var i=utils.getTiddler(t[n[r]]);if(i){e(i,i.fields.title)}}}}if(typeof e==="string"){e=$tw.wiki.compileFilter(e)}var l=e.call($tw.wiki,i);return l};utils.isMatch=function(e,t){var r=utils.getTiddlerReference(e);return utils.getMatches(t,[r]).length>0};utils.getTiddlerReference=function(e){if(e instanceof $tw.Tiddler){return e.fields.title}else if(typeof e==="string"){return e}};utils.getTiddler=function(e){return e instanceof $tw.Tiddler?e:$tw.wiki.getTiddler(e)};utils.getBasename=function(e){return e.substring(e.lastIndexOf("/")+1)};utils.notify=function(e){var t="$:/temp/tiddlymap/notify";$tw.wiki.addTiddler(new $tw.Tiddler({title:t,text:e}));$tw.notifier.display(t)};utils.tiddlerExists=function(e){var t=utils.getTiddlerReference(e);return t&&($tw.wiki.tiddlerExists(t)||$tw.wiki.isShadowTiddler(t))};utils.getPropertiesByPrefix=function(e,t,r){var i=utils.getEmptyMap();for(var n in e){if(utils.startsWith(n,t)){i[r?n.substr(t.length):n]=e[n]}}return i};utils.startsWith=function(e,t){return typeof e==="string"&&e.indexOf(t)===0};utils.hasElements=function(e){return Object.keys(e).length>0};utils.findAndRemoveClassNames=function(e){for(var t=0;t<e.length;t++){var r=document.getElementsByClassName(e[t]);for(var i=0;i<r.length;i++){$tw.utils.removeClass(r[i],e[t])}}};utils.isDraft=function(e){return utils.getTiddler(e)&&utils.getTiddler(e).isDraft()};utils.getText=function(e,t){if(!t){t=""}var r=utils.getTiddler(e);return r?r.fields.text:t};utils.keysOfItemsWithProperty=function(e,t,r,i){e=utils.getIterableCollection(e);var n=Object.keys(e);var l=[];var i=typeof i==="number"?i:n.length;for(var s=0;s<n.length;s++){var u=n[s];if(typeof e[u]==="object"&&e[u][t]){if(!r||e[u][t]===r){l.push(u);if(l.length===i){break}}}}return l};utils.keyOfItemWithProperty=function(e,t,r){var i=utils.keysOfItemsWithProperty(e,t,r,1);return i.length?i[0]:undefined};utils.getIterableCollection=function(e){return e instanceof vis.DataSet?e.get():e};utils.getLookupTable=function(e,t){e=utils.getIterableCollection(e);var r=utils.getEmptyMap();var i=Object.keys(e);for(var n=0;n<i.length;n++){var l=i[n];var s=t?e[l][t]:e[l];if(typeof s==="string"&&s!=""||typeof s==="number"){if(!r[s]){r[s]=e[l];continue}}throw'TiddlyMap: Cannot use "'+s+'" as lookup table index'}return r};utils.getArrayValuesAsHashmapKeys=function(e){return utils.getLookupTable(e)};utils.getTiddlersWithProperty=function(e,t,r){if(typeof r!=="object")r=utils.getEmptyMap();if(!r.tiddlers){r.tiddlers=$tw.wiki.allTitles()}var i=[];var n=r.isReturnRef;var l=Object.keys(r.tiddlers);for(var s=0;s<l.length;s++){var u=utils.getTiddler(r.tiddlers[l[s]]);if(u.fields[e]===t){i.push(n?u.fields.title:u);if(r.isIncludeDrafts){var a=$tw.wiki.findDraft(u.fields.title);if(a){i.push(n?a:$tw.wiki.getTiddler(a))}}}}return i};utils.getFullScreenApis=function(){var e=document,t=e.body,r={_requestFullscreen:t.webkitRequestFullscreen!==undefined?"webkitRequestFullscreen":t.mozRequestFullScreen!==undefined?"mozRequestFullScreen":t.msRequestFullscreen!==undefined?"msRequestFullscreen":t.requestFullscreen!==undefined?"requestFullscreen":"",_exitFullscreen:e.webkitExitFullscreen!==undefined?"webkitExitFullscreen":e.mozCancelFullScreen!==undefined?"mozCancelFullScreen":e.msExitFullscreen!==undefined?"msExitFullscreen":e.exitFullscreen!==undefined?"exitFullscreen":"",_fullscreenElement:e.webkitFullscreenElement!==undefined?"webkitFullscreenElement":e.mozFullScreenElement!==undefined?"mozFullScreenElement":e.msFullscreenElement!==undefined?"msFullscreenElement":e.fullscreenElement!==undefined?"fullscreenElement":"",_fullscreenChange:e.webkitFullscreenElement!==undefined?"webkitfullscreenchange":e.mozFullScreenElement!==undefined?"mozfullscreenchange":e.msFullscreenElement!==undefined?"MSFullscreenChange":e.fullscreenElement!==undefined?"fullscreenchange":""};if(!r._requestFullscreen||!r._exitFullscreen||!r._fullscreenElement){return null}else{return r}};utils.flatten=function(e,t){t=t||{};var r=t.delimiter||".";var i={};function n(e,l){Object.keys(e).forEach(function(s){var u=e[s];var a=t.safe&&Array.isArray(u);var f=Object.prototype.toString.call(u);var c=f==="[object Object]"||f==="[object Array]";var d=l?l+r+s:t.prefix+s;if(!a&&c){return n(u,d)}i[d]=u})}n(e);return i};utils.unflatten=function(e,t){t=t||{};var r=t.delimiter||".";var i={};if(Object.prototype.toString.call(e)!=="[object Object]"){return e}function n(e){var t=Number(e);return isNaN(t)||e.indexOf(".")!==-1?e:t}Object.keys(e).forEach(function(l){var s=l.split(r);var u=n(s.shift());var a=n(s[0]);var f=i;while(a!==undefined){if(f[u]===undefined){f[u]=typeof a==="number"&&!t.object?[]:{}}f=f[u];if(s.length>0){u=n(s.shift());a=n(s[0])}}f[u]=unflatten(e[l],t)});return i};utils.genUUID=function(){var e="0123456789abcdefghijklmnopqrstuvwxyz".split("");return function(){var t=e,r=new Array(36);var i=0,n;for(var l=0;l<36;l++){if(l==8||l==13||l==18||l==23){r[l]="-"}else if(l==14){r[l]="4"}else{if(i<=2)i=33554432+Math.random()*16777216|0;n=i&15;i=i>>4;r[l]=t[l==19?n&3|8:n]}}return r.join("")}}();exports.utils=utils;