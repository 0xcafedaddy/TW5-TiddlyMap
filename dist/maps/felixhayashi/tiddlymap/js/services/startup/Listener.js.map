{"version":3,"sources":["felixhayashi/tiddlymap/js/services/startup/Listener.js"],"names":["_NodeType","require","_EdgeType","_Edge","_utils","_vis","handleCancelDialog","_ref","param","_utils2","default","setField","handleClearTiddler","_ref2","arguments","length","undefined","paramObject","title","keep","tObj","originalFields","fields","fieldsToKeep","split","cloneFields","text","i","fieldName","$tw","wiki","deleteTiddler","addTiddler","Tiddler","_ref3$paramObject","_ref3","output","tiddlersStringArray","utils","parseStringArray","getMergedTiddlers","tiddlers","handleConfirmDialog","_ref4","handleSuppressDialog","_ref5","dialog","suppress","isTrue","$tm","ref","sysUserConf","_ref6","view","graph","adapter","getGraph","nodes","convert","edges","tRef","JSON","stringify","rootWidget","dispatchEvent","type","filename","handleConfigureSystem","allTiddlers","getMatches","selector","allPotentialNodes","allEdges","getEdgesForSet","plugin","getTiddler","path","pluginRoot","meta","getTiddlerData","sysMeta","hasLiveTab","liveTab","hasTag","handleDownloadGraph","numberOfNodes","numberOfEdges","Object","keys","pluginVersion","version","dataStructureVersion","dataStructureState","vis-inherited","_vis2","getText","visUserConf","config.sys","config","sys","open","args","isConfirmed","outTObj","getPropertiesByPrefix","setTiddlerData","handleGenerateWidget","_ref7","_ref7$paramObject","options","preselects","misc","defaultViewLabel","dialogManager","handleRemoveEdge","deleteEdge","handleCreateEdge","_ref9","from","to","isForce","force","tiddlerExists","id","makeNode","label","insertEdge","edge","notify","handleOpenTypeManager","_ref10","_ref10$paramObject","mode","match","allTypesSelector","allEdgeTypes","topic","allNodeTypes","typeRootPath","nodeTypes","searchSelector","handleLoadTypeForm","dialogTObj","_ref11","_EdgeType2","_NodeType2","save","outTRef","count","usage","fullPath","isShipped","vis","deleteByPrefix","_ref12","deleteType","saveType","logger","_processEdgesWithType","action","removeNodeType","getTiddlerRef","dialogOutput","loadFromTiddler","newId","newType","_ref13","load","name","platforms","after","before","synchronous","startup","handleCreateType","tmap:tm-remove-edge","tmap:tm-load-type-form","tmap:tm-save-type-form","handleSaveTypeForm","tmap:tm-create-type","tmap:tm-create-edge","tmap:tm-generate-widget","tmap:tm-clear-tiddler","tmap:tm-merge-tiddlers","handleMixTiddlers","tmap:tm-confirm-dialog"],"mappings":"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","file":"../../../../../../felixhayashi/tiddlymap/js/services/startup/Listener.js","sourcesContent":["// @preserve\n/*\\\n\ntitle: $:/plugins/felixhayashi/tiddlymap/js/startup/listener\ntype: application/javascript\nmodule-type: startup\n\n@preserve\n\n\\*/\n\n/*** Imports *******************************************************/\n\nimport NodeType from '$:/plugins/felixhayashi/tiddlymap/js/NodeType';\nimport EdgeType from '$:/plugins/felixhayashi/tiddlymap/js/EdgeType';\nimport Edge from '$:/plugins/felixhayashi/tiddlymap/js/Edge';\nimport utils from '$:/plugins/felixhayashi/tiddlymap/js/utils';\nimport visDefConf from '$:/plugins/felixhayashi/tiddlymap/js/config/vis';\n\n/*** Code **********************************************************/\n\n/**\n * @param {Object} param - event.param\n */\nconst handleCancelDialog = ({param}) => {\n  utils.setField(param, 'text', '');\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleClearTiddler = ({paramObject} = {})  => {\n\n  const {title, keep} = paramObject;\n\n  if (!title) return;\n\n  const tObj = utils.getTiddler(title);\n  const originalFields = tObj ? tObj.fields : {};\n  const fieldsToKeep = keep ? keep.split() : [];\n  const cloneFields = {\n    title,\n    text: '' // see https://github.com/Jermolene/TiddlyWiki5/issues/2025\n  };\n\n  for (let i = fieldsToKeep.length; i--;) {\n    const fieldName = fieldsToKeep[i];\n    cloneFields[fieldName] = originalFields[fieldName];\n  }\n\n  $tw.wiki.deleteTiddler(title);\n  $tw.wiki.addTiddler(new $tw.Tiddler(cloneFields));\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleMixTiddlers = ({paramObject = {}}) => {\n\n  const {tiddlers: tiddlersStringArray, output} = paramObject;\n\n  if (!tiddlersStringArray || !output) return;\n\n  const tiddlers = $tw.utils.parseStringArray(tiddlersStringArray);\n  const tObj = utils.getMergedTiddlers(tiddlers, output);\n\n  $tw.wiki.addTiddler(tObj);\n\n};\n\n/**\n * @param {string} param - event.param\n */\nconst handleConfirmDialog = ({param}) => {\n\n  utils.setField(param, 'text', '1');\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleSuppressDialog = ({paramObject}) => {\n\n  const {dialog, suppress} = paramObject;\n\n  if (utils.isTrue(suppress, false)) {\n    utils.setEntry($tm.ref.sysUserConf, `suppressedDialogs.${dialog}`, true);\n  }\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleDownloadGraph = ({paramObject}) => {\n\n  const { view } = paramObject;\n  const graph = $tm.adapter.getGraph({ view });\n\n  graph.nodes = utils.convert(graph.nodes, 'array');\n  graph.edges = utils.convert(graph.edges, 'array');\n\n  const tRef = '$:/temp/tmap/export';\n\n  utils.setField(tRef, 'text', JSON.stringify(graph, null, 2));\n\n  $tw.rootWidget.dispatchEvent({\n    type: 'tm-download-file',\n    param: tRef,\n    paramObject: {\n      filename: `${view}.json`\n    }\n  });\n};\n\n/**\n *\n */\nconst handleConfigureSystem = () => {\n\n  const allTiddlers = utils.getMatches($tm.selector.allPotentialNodes);\n  const allEdges = $tm.adapter.getEdgesForSet(allTiddlers);\n  const plugin = $tw.wiki.getTiddler($tm.path.pluginRoot).fields;\n  const meta = $tw.wiki.getTiddlerData($tm.ref.sysMeta);\n  const hasLiveTab = utils.getTiddler($tm.ref.liveTab).hasTag('$:/tags/SideBar');\n\n  const args = {\n    numberOfNodes: '' + allTiddlers.length,\n    numberOfEdges: '' + Object.keys(allEdges).length,\n    pluginVersion: `v${plugin.version}`,\n    dataStructureVersion: `v${meta.dataStructureState}`,\n    dialog: {\n      preselects: {\n        'liveTab': '' + hasLiveTab,\n        'vis-inherited': JSON.stringify(visDefConf),\n        'config.vis': utils.getText($tm.ref.visUserConf),\n        'config.sys': $tm.config.sys,\n      }\n    }\n  };\n\n  $tm.dialogManager.open('globalConfig', args, (isConfirmed, outTObj) => {\n\n    if (!isConfirmed) return;\n\n    const config = utils.getPropertiesByPrefix(outTObj.fields, 'config.sys.', true);\n\n    // CAREFUL: this is a data tiddler!\n    $tw.wiki.setTiddlerData($tm.ref.sysUserConf, config);\n\n    // show or hide the live tab; to hide the live tab, we override\n    // the shadow tiddler; to show it, we remove the overlay again.\n    if (utils.isTrue(outTObj.fields.liveTab, false)) {\n      utils.setField($tm.ref.liveTab, 'tags', '$:/tags/SideBar');\n    } else {\n      $tw.wiki.deleteTiddler($tm.ref.liveTab);\n    }\n\n    // tw doesn't translate the json to an object so this is already a string\n    utils.setField($tm.ref.visUserConf, 'text', outTObj.fields['config.vis']);\n\n  });\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleGenerateWidget = ({paramObject = {}}) => {\n\n  const options = {\n    dialog: {\n      preselects: {\n        view: (paramObject.view || $tm.misc.defaultViewLabel)\n      }\n    }\n  };\n\n  $tm.dialogManager.open('widgetCodeGenerator', options);\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleRemoveEdge = ({paramObject}) => {\n\n  $tm.adapter.deleteEdge(paramObject);\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleCreateEdge = ({paramObject}) => {\n\n  const {from, to, force: isForce} = paramObject;\n\n  if (!from || !to) return;\n\n  if ((utils.tiddlerExists(from) && utils.tiddlerExists(to)) || isForce) {\n\n    // will not override any existing tiddlers…\n    utils.addTiddler(to);\n    utils.addTiddler(from);\n\n    const edge = new Edge(\n      $tm.adapter.makeNode(from).id,\n      $tm.adapter.makeNode(to).id,\n      paramObject.label,\n      paramObject.id\n    );\n\n    $tm.adapter.insertEdge(edge);\n    $tm.notify('Edge inserted');\n\n  }\n\n};\n\n/**\n * @param {string} type - event.type\n * @param {Object} [paramObject] - event.paramObject\n */\nconst handleOpenTypeManager = ({type, paramObject = {}}) => {\n\n  // either 'manage-edge-types' or 'manage-node-types'\n  const mode = type.match(/tmap:tm-(.*)/)[1];\n\n  if (mode === 'manage-edge-types') {\n    var topic = 'Edge-Type Manager';\n    var allTypesSelector = $tm.selector.allEdgeTypes;\n    var typeRootPath = $tm.path.edgeTypes;\n  } else {\n    var topic = 'Node-Type Manager';\n    var allTypesSelector = $tm.selector.allNodeTypes;\n    var typeRootPath = $tm.path.nodeTypes;\n  }\n\n  const args = {\n    mode: mode,\n    topic: topic,\n    searchSelector: allTypesSelector,\n    typeRootPath: typeRootPath\n  };\n\n  const dialogTObj = $tm.dialogManager.open('MapElementTypeManager', args);\n\n  if (paramObject.type) {\n    handleLoadTypeForm({\n      paramObject: {\n        mode: mode,\n        id: paramObject.type,\n        output: dialogTObj.fields['output']\n      }\n    });\n  }\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleLoadTypeForm = ({paramObject}) => {\n\n  const outTRef = paramObject.output;\n\n  const type = (paramObject.mode === 'manage-edge-types'\n    ? new EdgeType(paramObject.id)\n    : new NodeType(paramObject.id));\n\n  // inject all the type data as fields into the dialog output\n  type.save(outTRef);\n\n  // fields that need preprocessing\n\n  if (paramObject.mode === 'manage-edge-types') {\n    const usage = $tm.adapter.selectEdgesByType(type);\n    const count = Object.keys(usage).length;\n    utils.setField(outTRef, 'temp.usageCount', count);\n  }\n\n  $tw.wiki.addTiddler(new $tw.Tiddler(\n    utils.getTiddler(outTRef),\n    {\n      'typeTRef': type.fullPath,\n      'temp.idImmutable': (type.isShipped ? 'true' : ''),\n      'temp.newId': type.id,\n      'vis-inherited': JSON.stringify($tm.config.vis)\n    }\n  ));\n\n  // reset the tabs to default\n  utils.deleteByPrefix('$:/state/tabs/MapElementTypeManager');\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleSaveTypeForm = ({paramObject}) => {\n\n  const tObj = utils.getTiddler(paramObject.output);\n  if (!tObj) return;\n\n  const id = tObj.fields.id;\n  const mode = paramObject.mode;\n  const type = (mode === 'manage-edge-types' ? new EdgeType(id) : new NodeType(id));\n\n  if (utils.isTrue(tObj.fields['temp.deleteType'], false)) {\n    deleteType(mode, type, tObj);\n  } else {\n    saveType(mode, type, tObj);\n  }\n\n};\n\nconst deleteType = (mode, type, dialogOutput) => {\n\n  $tm.logger('debug', 'Deleting type', type);\n\n  if (mode === 'manage-edge-types') {\n    $tm.adapter._processEdgesWithType(type, {action: 'delete'});\n  } else {\n    $tm.adapter.removeNodeType(type);\n  }\n\n  $tw.wiki.addTiddler(new $tw.Tiddler({\n    title: utils.getTiddlerRef(dialogOutput)\n  }));\n\n  $tm.notify('Deleted type');\n\n};\n\nconst saveType = (mode, type, dialogOutput) => {\n\n  const tObj = utils.getTiddler(dialogOutput);\n\n  // update the type with the form data\n  type.loadFromTiddler(tObj);\n  type.save();\n\n  const newId = tObj.fields['temp.newId'];\n\n  if (newId && newId !== tObj.fields['id']) { //renamed\n\n    if (mode === 'manage-edge-types') {\n\n      $tm.adapter._processEdgesWithType(type, {\n        action: 'rename',\n        newName: newId\n      });\n\n    } else {\n\n      const newType = new NodeType(newId);\n      newType.load(type);\n      newType.save();\n      $tw.wiki.deleteTiddler(type.fullPath);\n\n    }\n\n    utils.setField(tObj, 'id', newId);\n\n  }\n\n  $tm.notify('Saved type data');\n\n};\n\n/**\n * @param {Object} paramObject - event.paramObject\n */\nconst handleCreateType = ({paramObject}) => {\n\n  const id = paramObject.id || 'New type';\n  const type = (paramObject.mode === 'manage-edge-types'\n    ? new EdgeType(id)\n    : new NodeType(id));\n  type.save();\n\n  handleLoadTypeForm({\n    paramObject: {\n      id: type.id,\n      mode: paramObject.mode,\n      output: paramObject.output\n    }\n  });\n\n};\n\n/*** Exports *******************************************************/\n\nexport const name = 'tmap.listener';\nexport const platforms = [ 'browser' ];\nexport const after = [ 'rootwidget', 'tmap.caretaker' ];\nexport const before = [ 'story' ];\nexport const synchronous = true;\nexport const startup = () => {\n  utils.addTWlisteners({\n    'tmap:tm-remove-edge': handleRemoveEdge,\n    'tmap:tm-load-type-form': handleLoadTypeForm,\n    'tmap:tm-save-type-form': handleSaveTypeForm,\n    'tmap:tm-create-type': handleCreateType,\n    'tmap:tm-create-edge': handleCreateEdge,\n    'tmap:tm-suppress-dialog': handleSuppressDialog,\n    'tmap:tm-generate-widget': handleGenerateWidget,\n    'tmap:tm-download-graph': handleDownloadGraph,\n    'tmap:tm-configure-system': handleConfigureSystem,\n    'tmap:tm-manage-edge-types': handleOpenTypeManager,\n    'tmap:tm-manage-node-types': handleOpenTypeManager,\n    'tmap:tm-cancel-dialog': handleCancelDialog,\n    'tmap:tm-clear-tiddler': handleClearTiddler,\n    'tmap:tm-merge-tiddlers': handleMixTiddlers,\n    'tmap:tm-confirm-dialog': handleConfirmDialog\n  }, $tw.rootWidget, this);\n};\n"],"sourceRoot":"../../../../../../../src/plugins"}